<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Jumys.online</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;900&display=swap" rel="stylesheet">

  <style>
    /* ===== BASE ===== */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f4f6f9;
      background-image: url("home-background.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: #172343;
      overflow-x: hidden;
    }

    body::-webkit-scrollbar { width: 8px; }
    body::-webkit-scrollbar-track { background: transparent; }
    body::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 4px; }

    :root {
      --pad: 20px;
      --shadow: 0px 5px 20px rgba(0,0,0,0.05);
      --border: 1px solid rgba(255, 255, 255, 0.5);
      --radius: 20px;
      --primary: #00205b;
      --vip-gold: #FFD700;
    }

    .app { width: 100%; min-height: 100vh; display: flex; flex-direction: column; }
    .content { width: 100%; max-width: 1200px; margin: 0 auto; padding: 40px var(--pad); display: flex; flex-direction: column; gap: 24px; }

    /* SEARCH */
    .search-container { width: 100%; display: flex; flex-direction: column; gap: 10px; }
    .search { position: relative; width: 100%; }
    .search-bg {
      height: 48px; width: 100%; border-radius: 16px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.5);
      box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }
    .searchbar { position: absolute; inset: 0; display: flex; align-items: center; gap: 12px; padding: 0 16px; }
    .searchbar input { border: 0; outline: 0; background: transparent; width: 100%; font-size: 15px; color: #172343; font-family: inherit; font-weight: 500; }
    .question { font-size: 24px; font-weight: 800; color: #172343; letter-spacing: -0.5px; }

    /* CATEGORIES */
    .categories { display: flex; gap: 14px; width: 100%; }
    .category { 
  flex: 1; 
  position: relative; 
  border-radius: var(--radius); 
  cursor: pointer; 
  overflow: hidden; 
  aspect-ratio: 10/6 !important; /* Добавь это, чтобы перебить остальные стили */
  transition: transform 0.2s; 
  background: rgba(255, 255, 255, 0.6); 
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.4);
}
    .category.is-active { transform: scale(1.02); z-index: 2; box-shadow: 0 15px 30px rgba(0,80,255,0.25); border: 1px solid rgba(255, 255, 255, 0.8); }
    .category__bg { position: absolute; inset: 0; background: linear-gradient(180deg, #0069ff 0%, #00afff 100%); opacity: 0.85; }
    .category--worker .category__bg { transform: rotate(180deg); }
    .category__content { position: relative; z-index: 1; height: 100%; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
    .category__title { font-size: 19px; font-weight: 700; color: #fff; line-height: 1; }
    .category__subtitle { font-size: 13px; color: rgba(255,255,255,0.9); font-weight: 500; }
    .category__count { font-size: 12px; color: rgba(255,255,255,0.9); background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; align-self: flex-start; }

    /* ADD BANNER */
    .add-action-box {
      width: 100%; padding: 16px; border-radius: 20px;
      background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px);
      border: 1px dashed var(--primary); display: flex; align-items: center; justify-content: space-between;
      text-decoration: none; transition: all 0.2s ease;
    }
    .add-action-box:active { transform: scale(0.98); }
    .add-action-title { font-size: 15px; font-weight: 800; color: var(--primary); }
    .add-action-sub { font-size: 12px; color: #666; font-weight: 500; }
    .add-action-icon { width: 36px; height: 36px; background: var(--primary); color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; }

    /* SECTION HEADER */
    .section-row { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; gap: 10px; }
    .section-title { font-size: 20px; font-weight: 700; color: #172343; line-height: 1.2; }
    .show-all { flex-shrink: 0; padding: 8px 16px; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 99px; border: var(--border); font-size: 13px; font-weight: 600; cursor: pointer; }

    /* CARDS GRID */
    .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; padding-bottom: 40px; }
    
    .card { 
      background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px);
      border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.5); 
      padding: 20px; display: flex; flex-direction: column; height: 100%; transition: transform 0.2s; position: relative;
    }
    .card:hover { transform: translateY(-3px); background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }

    /* VIP STYLE */
    .card--vip { border: 1.5px solid var(--vip-gold); background: linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 253, 235, 0.9) 100%); }
    .vip-badge { position: absolute; top: -10px; right: 15px; background: var(--vip-gold); color: #000; font-size: 10px; font-weight: 900; padding: 3px 10px; border-radius: 8px; }

    .card__top { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; margin-bottom: 12px; }
    .card__left { display: flex; gap: 12px; align-items: center; overflow: hidden; }
    .card__icon { width: 36px; height: 36px; flex-shrink: 0; object-fit: contain; border-radius: 8px; }
    .card__title { font-size: 17px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .card__sub { font-size: 13px; color: #888; margin-top: 2px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .card__salary { flex-shrink: 0; font-size: 15px; font-weight: 700; color: #009945; background: #eafff0; padding: 4px 8px; border-radius: 6px; }
    .card__desc { font-size: 14px; line-height: 1.5; color: #444; flex-grow: 1; margin-bottom: 16px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; } 
    .card__bottom { display: flex; align-items: center; justify-content: space-between; margin-top: auto; }
    .card__tags { display: flex; gap: 6px; overflow: hidden; }
    .card__more { flex-shrink: 0; height: 36px; padding: 0 18px; border-radius: 99px; background: var(--primary); color: #fff; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; }

    .tag { height: 26px; padding: 0 10px; border-radius: 99px; display: inline-flex; align-items: center; font-size: 11px; font-weight: 600; white-space: nowrap; }
    .tag--cyan { background: #e0fbfd; color: #006c75; }
    .tag--pink { background: #ffebeb; color: #8f0000; }
    .tag--green { background: #e6f9ed; color: #027a3b; }
    .tag--purple { background: #f3e8ff; color: #5a00b8; }
    .tag--orange { background: #fff4e5; color: #b35c00; }    
    .tag--blue { background: #e5f0ff; color: #0047b3; }
    .tag--yellow { background: #fff9e5; color: #b38a00; }
    .tag--gray { background: #f0f0f0; color: #666666; }

    /* SKELETON */
    .skeleton-box { background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); background-size: 200% 100%; animation: shine 1.5s linear infinite; border-radius: 8px; }
    @keyframes shine { to { background-position-x: -200%; } }
    .sk-card { min-height: 220px; }

    /* ===== DESKTOP ADAPTIVITY ===== */
    @media (min-width: 768px) {
      .question { font-size: 32px; text-align: center; margin-bottom: 10px; }
      .search-container { max-width: 800px; margin: 0 auto; }
      .categories { max-width: 800px; margin: 0 auto; gap: 24px; }
      .category { aspect-ratio: 15/5; } /* Более вытянутые кнопки категорий на десктопе */
      .add-action-box { max-width: 800px; margin: 0 auto; }
      .section-row { max-width: 1200px; margin: 20px auto 10px; }
      .cards { grid-template-columns: repeat(2, 1fr); gap: 30px; } /* Две колонки на планшетах/ноутбуках */
    }

    @media (min-width: 1024px) {
      .cards { grid-template-columns: repeat(3, 1fr); } /* Три колонки на больших мониторах */
      .question { font-size: 40px; }
    }

    @media (max-width: 767px) {
      .app { max-width: 100%; background: transparent; }
      .content { padding: 20px 16px; }
      .cards { grid-template-columns: 1fr; }
      .category { aspect-ratio: 167/197; } /* Возвращаем мобильный вид пропорций */
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="content">

      <div class="search-container">
        <div class="question" data-i18n="question">Не іздеп отырсыз?</div>
        <div class="search">
          <div class="search-bg"></div>
          <div class="searchbar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input id="q" placeholder="..." autocomplete="off">
          </div>
        </div>
      </div>

      <div class="categories">
        <div class="category category--work is-active" id="catWork" data-type="vacancy">
          <div class="category__bg"></div>
          <div class="category__content">
            <div class="cat-top">
                <div class="category__title" data-i18n="cat_work">Жұмыс</div>
                <div class="category__subtitle" data-i18n="cat_work_sub">Вакансиялар</div>
            </div>
            <div class="category__count" id="countVac">...</div>
          </div>
        </div>
        <div class="category category--worker" id="catWorker" data-type="profile">
          <div class="category__bg"></div>
          <div class="category__content">
             <div class="cat-top">
                <div class="category__title" data-i18n="cat_worker">Жұмысшы</div>
                <div class="category__subtitle" data-i18n="cat_worker_sub">Анкеталар</div>
            </div>
            <div class="category__count" id="countProf">...</div>
          </div>
        </div>
      </div>

      <a href="https://t.me/@jumys_online_bot" target="_blank" class="add-action-box">
        <div class="add-action-text">
          <div class="add-action-title" data-i18n="add_title">Өз хабарландыруыңды қос</div>
          <div class="add-action-sub" data-i18n="add_sub">Жұмыс немесе жұмысшы іздеу 1000₸</div>
        </div>
        <div class="add-action-icon">+</div>
      </a>

      <div class="section-row">
        <div class="section-title" id="sectionTitle" data-i18n="section_title_vac">Ұсынылған вакансиялар</div>
        <div class="show-all" id="showAll" data-i18n="show_all">Бәрі</div>
      </div>

      <div class="cards" id="cards">
        <div class="card sk-card">
          <div style="display:flex;gap:12px"><div class="skeleton-box" style="height:36px;width:36px"></div><div style="flex:1"><div class="skeleton-box" style="height:14px;width:60%;margin-bottom:6px"></div><div class="skeleton-box" style="height:10px;width:40%"></div></div></div>
          <div class="skeleton-box" style="height:60px;width:100%;margin:16px 0"></div>
          <div style="display:flex;justify-content:space-between;align-items:center"><div class="skeleton-box" style="height:26px;width:80px;border-radius:20px"></div><div class="skeleton-box" style="height:36px;width:100px;border-radius:20px"></div></div>
        </div>
        <div class="card sk-card">
          <div style="display:flex;gap:12px"><div class="skeleton-box" style="height:36px;width:36px"></div><div style="flex:1"><div class="skeleton-box" style="height:14px;width:60%;margin-bottom:6px"></div><div class="skeleton-box" style="height:10px;width:40%"></div></div></div>
          <div class="skeleton-box" style="height:60px;width:100%;margin:16px 0"></div>
          <div style="display:flex;justify-content:space-between;align-items:center"><div class="skeleton-box" style="height:26px;width:80px;border-radius:20px"></div><div class="skeleton-box" style="height:36px;width:100px;border-radius:20px"></div></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyf9kKiLvAnazrc_3X3riq5QSDaex8Rcrtk_VwxPA6D6jNZCCNAR9O8ibCz9_K1ojPTVA/exec";

    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    const currentLang = (urlLang === "ru") ? "ru" : (localStorage.getItem("lang") === "ru" ? "ru" : "kz");

    const translations = {
      kz: { 
        question: "Не іздеп отырсыз?", placeholder: "Кілт сөз...", cat_work: "Жұмыс", cat_work_sub: "Вакансиялар қарау", cat_worker: "Жұмысшы", cat_worker_sub: "Анкеталар қарау", section_title_vac: "Ұсынылған вакансиялар", section_title_prof: "Ұсынылған анкеталар", show_all: "Бәрі", not_found: "Ештеңе табылмады :(", open_btn: "Ашу", vac_count: " вакансия", prof_count: " анкета",
        add_title: "Өз хабарландыруыңды қос", add_sub: "Жұмыс немесе жұмысшы іздеу 1000₸"
      },
      ru: { 
        question: "Что вы ищете?", placeholder: "Ключевое слово...", cat_work: "Работа", cat_work_sub: "Смотреть вакансии", cat_worker: "Работник", cat_worker_sub: "Смотреть анкеты", section_title_vac: "Рекомендуемые вакансии", section_title_prof: "Рекомендуемые анкеты", show_all: "Все", not_found: "Ничего не найдено :(", open_btn: "Открыть", vac_count: " вакансий", prof_count: " анкет",
        add_title: "Добавить своё объявление", add_sub: "Поиск работы или сотрудников 1000₸"
      }
    };

    function applyLang() {
      const t = translations[currentLang];
      document.querySelectorAll("[data-i18n]").forEach(el => el.textContent = t[el.dataset.i18n]);
      document.getElementById("q").placeholder = t.placeholder;
    }
    applyLang();

    const state = { type: "vacancy", q: "" };
    let items = [];

    function escapeHtml(s){ return String(s ?? "").replace(/[&<>"']/g, m => ({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m])); }

    function tagClass(tone){
      const map = {cyan:"tag--cyan",pink:"tag--pink",green:"tag--green",purple:"tag--purple",orange:"tag--orange",blue:"tag--blue",yellow:"tag--yellow"};
      return "tag " + (map[(tone || "").toLowerCase()] || "tag--gray");
    }

    function renderCard(x){
      const t = translations[currentLang];
      const tagsHtml = (x.tags || []).slice(0, 3).map(k => `<span class="${tagClass(k.tone)}">${escapeHtml(k.text)}</span>`).join("");
      const isVip = x.is_vip == "1";

      return `
        <article class="card ${isVip ? 'card--vip' : ''}">
          ${isVip ? `<div class="vip-badge">TOP</div>` : ''}
          <div class="card__top">
            <div class="card__left">
              <img class="card__icon" src="${x.icon || 'https://via.placeholder.com/40'}" alt="icon" onerror="this.src='https://via.placeholder.com/40'">
              <div class="card__meta">
                <div class="card__title">${escapeHtml(x.title)}</div>
                <div class="card__sub">${escapeHtml(x.subtitle)}</div>
              </div>
            </div>
            <div class="card__salary">${escapeHtml(x.salary)}</div>
          </div>
          <div class="card__desc">${escapeHtml(x.desc)}</div>
          <div class="card__bottom">
            <div class="card__tags">${tagsHtml}</div>
            <a class="card__more" href="card.html?id=${encodeURIComponent(x.id)}&lang=${currentLang}">${t.open_btn}</a>
          </div>
        </article>
      `;
    }

    function draw(){
      const q = state.q.trim().toLowerCase();
      let list = items.filter(x => {
        if (x.type !== state.type) return false;
        if (!q) return true;
        return (x.title + " " + x.subtitle + " " + x.desc).toLowerCase().includes(q);
      });

      list.sort((a, b) => (b.is_vip || 0) - (a.is_vip || 0));

      const container = document.getElementById("cards");
      const t = translations[currentLang];

      if(list.length === 0 && items.length > 0) {
        container.innerHTML = `<div style="grid-column: 1/-1; text-align:center; padding: 40px; color:#888;">${t.not_found}</div>`;
      } else if (items.length > 0) {
        container.innerHTML = list.map(renderCard).join("");
      }

      document.getElementById("countVac").textContent = items.filter(x => x.type === "vacancy").length + t.vac_count;
      document.getElementById("countProf").textContent = items.filter(x => x.type === "profile").length + t.prof_count;
      document.getElementById("sectionTitle").textContent = state.type === "vacancy" ? t.section_title_vac : t.section_title_prof;
    }

    async function loadFromSheets(){
      try {
        const res = await fetch(API_URL);
        const raw = await res.json();
        items = raw.map(x => ({
          ...x,
          type: (x.type || "vacancy").toLowerCase(),
          is_vip: x.is_vip || 0,
          tags: [
            x.tag1 ? { text: x.tag1, tone: x.tag1_tone } : null,
            x.tag2 ? { text: x.tag2, tone: x.tag2_tone } : null
          ].filter(Boolean)
        }));
        draw();
      } catch(e) { console.error(e); }
    }

    document.getElementById("q").addEventListener("input", (e) => { state.q = e.target.value; draw(); });
    document.getElementById("catWork").onclick = () => { state.type = "vacancy"; document.getElementById("catWork").classList.add("is-active"); document.getElementById("catWorker").classList.remove("is-active"); draw(); };
    document.getElementById("catWorker").onclick = () => { state.type = "profile"; document.getElementById("catWorker").classList.add("is-active"); document.getElementById("catWork").classList.remove("is-active"); draw(); };
    document.getElementById("showAll").onclick = () => { state.q = ""; document.getElementById("q").value = ""; draw(); };

    loadFromSheets();
  </script>
</body>
</html>